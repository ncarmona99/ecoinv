(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6414],{6414:(B,w,b)=>{"use strict";b.d(w,{J:()=>Xr});var h=b(467),S=b(1626),U=b(6354);class d extends Error{constructor(r,e="FunctionsError",t){super(r),this.name=e,this.context=t}}class f extends d{constructor(r){super("Failed to send a request to the Edge Function","FunctionsFetchError",r)}}class g extends d{constructor(r){super("Relay Error invoking the Edge Function","FunctionsRelayError",r)}}class v extends d{constructor(r){super("Edge Function returned a non-2xx status code","FunctionsHttpError",r)}}var A=function(s){return s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2",s}(A||{});class x{constructor(r,{headers:e={},customFetch:t,region:n=A.Any}={}){this.url=r,this.headers=e,this.region=n,this.fetch=(s=>{let r;return r=s||(typeof fetch>"u"?(...e)=>Promise.resolve().then(b.bind(b,5286)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)})(t)}setAuth(r){this.headers.Authorization=`Bearer ${r}`}invoke(r,e={}){var t;return function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(c){try{u(t.next(c))}catch(p){o(p)}}function l(c){try{u(t.throw(c))}catch(p){o(p)}}function u(c){c.done?i(c.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(c.value).then(a,l)}u((t=t.apply(s,r||[])).next())})}(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:o}=e;let u,a={},{region:l}=e;l||(l=this.region),l&&"any"!==l&&(a["x-region"]=l),o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",u=o):"string"==typeof o?(a["Content-Type"]="text/plain",u=o):typeof FormData<"u"&&o instanceof FormData?u=o:(a["Content-Type"]="application/json",u=JSON.stringify(o)));const c=yield this.fetch(`${this.url}/${r}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),n),body:u}).catch(y=>{throw new f(y)}),p=c.headers.get("x-relay-error");if(p&&"true"===p)throw new g(c);if(!c.ok)throw new v(c);let m,_=(null!==(t=c.headers.get("Content-Type"))&&void 0!==t?t:"text/plain").split(";")[0].trim();return m="application/json"===_?yield c.json():"application/octet-stream"===_?yield c.blob():"text/event-stream"===_?c:"multipart/form-data"===_?yield c.formData():yield c.text(),{data:m,error:null}}catch(n){return{data:null,error:n}}})}}var P=b(4060);const{PostgrestClient:C}=P,re={"X-Client-Info":"realtime-js/2.10.9"};var K=function(s){return s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed",s}(K||{}),D=function(s){return s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving",s}(D||{}),W=function(s){return s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token",s}(W||{}),Ve=function(s){return s.websocket="websocket",s}(Ve||{}),ce=function(s){return s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed",s}(ce||{});class At{constructor(){this.HEADER_LENGTH=1}decode(r,e){return r.constructor===ArrayBuffer?e(this._binaryDecode(r)):e("string"==typeof r?JSON.parse(r):{})}_binaryDecode(r){const e=new DataView(r),t=new TextDecoder;return this._decodeBroadcast(r,e,t)}_decodeBroadcast(r,e,t){const n=e.getUint8(1),i=e.getUint8(2);let o=this.HEADER_LENGTH+2;const a=t.decode(r.slice(o,o+n));o+=n;const l=t.decode(r.slice(o,o+i));return o+=i,{ref:null,topic:a,event:l,payload:JSON.parse(t.decode(r.slice(o,r.byteLength)))}}}class Qe{constructor(r,e){this.callback=r,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=r,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var R=function(s){return s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange",s}(R||{});const Xe=(s,r,e={})=>{var t;const n=null!==(t=e.skipTypes)&&void 0!==t?t:[];return Object.keys(r).reduce((i,o)=>(i[o]=kt(o,s,r,n),i),{})},kt=(s,r,e,t)=>{const n=r.find(a=>a.name===s),i=null==n?void 0:n.type,o=e[s];return i&&!t.includes(i)?Ze(i,o):Oe(o)},Ze=(s,r)=>{if("_"===s.charAt(0)){const e=s.slice(1,s.length);return Et(r,e)}switch(s){case R.bool:return St(r);case R.float4:case R.float8:case R.int2:case R.int4:case R.int8:case R.numeric:case R.oid:return Tt(r);case R.json:case R.jsonb:return Ot(r);case R.timestamp:return Pt(r);default:return Oe(r)}},Oe=s=>s,St=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},Tt=s=>{if("string"==typeof s){const r=parseFloat(s);if(!Number.isNaN(r))return r}return s},Ot=s=>{if("string"==typeof s)try{return JSON.parse(s)}catch(r){return console.log(`JSON parse error: ${r}`),s}return s},Et=(s,r)=>{if("string"!=typeof s)return s;const e=s.length-1;if("{"===s[0]&&"}"===s[e]){let i;const o=s.slice(1,e);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Ze(r,a))}return s},Pt=s=>"string"==typeof s?s.replace(" ","T"):s,Ye=s=>{let r=s;return r=r.replace(/^ws/i,"http"),r=r.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),r.replace(/\/+$/,"")};class Ee{constructor(r,e,t={},n=1e4){this.channel=r,this.event=e,this.payload=t,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(r){this.timeout=r,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(r){this.payload=Object.assign(Object.assign({},this.payload),r)}receive(r,e){var t;return this._hasReceived(r)&&e(null===(t=this.receivedResp)||void 0===t?void 0:t.response),this.recHooks.push({status:r,callback:e}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(r,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:r,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:r,response:e}){this.recHooks.filter(t=>t.status===r).forEach(t=>t.callback(e))}_hasReceived(r){return this.receivedResp&&this.receivedResp.status===r}}class fe{constructor(r,e){this.channel=r,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const t=(null==e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(t.state,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=fe.syncState(this.state,n,i,o),this.pendingDiffs.forEach(l=>{this.state=fe.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(t.diff,{},n=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=fe.syncDiff(this.state,n,i,o),a())}),this.onJoin((n,i,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:o})}),this.onLeave((n,i,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(r,e,t,n){const i=this.cloneDeep(r),o=this.transformState(e),a={},l={};return this.map(i,(u,c)=>{o[u]||(l[u]=c)}),this.map(o,(u,c)=>{const p=i[u];if(p){const _=c.map(E=>E.presence_ref),m=p.map(E=>E.presence_ref),y=c.filter(E=>m.indexOf(E.presence_ref)<0),j=p.filter(E=>_.indexOf(E.presence_ref)<0);y.length>0&&(a[u]=y),j.length>0&&(l[u]=j)}else a[u]=c}),this.syncDiff(i,{joins:a,leaves:l},t,n)}static syncDiff(r,e,t,n){const{joins:i,leaves:o}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return t||(t=()=>{}),n||(n=()=>{}),this.map(i,(a,l)=>{var u;const c=null!==(u=r[a])&&void 0!==u?u:[];if(r[a]=this.cloneDeep(l),c.length>0){const p=r[a].map(m=>m.presence_ref),_=c.filter(m=>p.indexOf(m.presence_ref)<0);r[a].unshift(..._)}t(a,c,l)}),this.map(o,(a,l)=>{let u=r[a];if(!u)return;const c=l.map(p=>p.presence_ref);u=u.filter(p=>c.indexOf(p.presence_ref)<0),r[a]=u,n(a,u,l),0===u.length&&delete r[a]}),r}static map(r,e){return Object.getOwnPropertyNames(r).map(t=>e(t,r[t]))}static transformState(r){return r=this.cloneDeep(r),Object.getOwnPropertyNames(r).reduce((e,t)=>{const n=r[t];return e[t]="metas"in n?n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n,e},{})}static cloneDeep(r){return JSON.parse(JSON.stringify(r))}onJoin(r){this.caller.onJoin=r}onLeave(r){this.caller.onLeave=r}onSync(r){this.caller.onSync=r}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}class Pe{constructor(r,e={config:{}},t){this.topic=r,this.params=e,this.socket=t,this.bindings={},this.state=D.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=r.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new Ee(this,W.join,this.params,this.timeout),this.rejoinTimer=new Qe(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=D.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=D.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=D.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=D.errored,this.rejoinTimer.scheduleTimeout())}),this._on(W.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new fe(this),this.broadcastEndpointURL=Ye(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(r,e=this.timeout){var t,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:o,private:a}}=this.params;this._onError(c=>r&&r("CHANNEL_ERROR",c)),this._onClose(()=>r&&r("CLOSED"));const l={},u={broadcast:i,presence:o,postgres_changes:null!==(n=null===(t=this.bindings.postgres_changes)||void 0===t?void 0:t.map(c=>c.filter))&&void 0!==n?n:[],private:a};this.socket.accessToken&&(l.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:u},l)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",({postgres_changes:c})=>{var p;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),void 0!==c){const _=this.bindings.postgres_changes,m=null!==(p=null==_?void 0:_.length)&&void 0!==p?p:0,y=[];for(let j=0;j<m;j++){const E=_[j],{filter:{event:H,schema:V,table:X,filter:Q}}=E,z=c&&c[j];if(!z||z.event!==H||z.schema!==V||z.table!==X||z.filter!==Q)return this.unsubscribe(),void(r&&r("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes")));y.push(Object.assign(Object.assign({},E),{id:z.id}))}return this.bindings.postgres_changes=y,void(r&&r("SUBSCRIBED"))}r&&r("SUBSCRIBED")}).receive("error",c=>{r&&r("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{r&&r("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(r,e={}){var t=this;return(0,h.A)(function*(){return yield t.send({type:"presence",event:"track",payload:r},e.timeout||t.timeout)})()}untrack(r={}){var e=this;return(0,h.A)(function*(){return yield e.send({type:"presence",event:"untrack"},r)})()}on(r,e,t){return this._on(r,e,t)}send(r,e={}){var t=this;return(0,h.A)(function*(){var n,i;if(t._canPush()||"broadcast"!==r.type)return new Promise(o=>{var a,l,u;const c=t._push(r.type,r,e.timeout||t.timeout);"broadcast"===r.type&&!(null!==(u=null===(l=null===(a=t.params)||void 0===a?void 0:a.config)||void 0===l?void 0:l.broadcast)&&void 0!==u&&u.ack)&&o("ok"),c.receive("ok",()=>o("ok")),c.receive("error",()=>o("error")),c.receive("timeout",()=>o("timed out"))});{const{event:o,payload:a}=r,l={method:"POST",headers:{Authorization:t.socket.accessToken?`Bearer ${t.socket.accessToken}`:"",apikey:t.socket.apiKey?t.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:t.subTopic,event:o,payload:a,private:t.private}]})};try{const u=yield t._fetchWithTimeout(t.broadcastEndpointURL,l,null!==(n=e.timeout)&&void 0!==n?n:t.timeout);return yield null===(i=u.body)||void 0===i?void 0:i.cancel(),u.ok?"ok":"error"}catch(u){return"AbortError"===u.name?"timed out":"error"}}})()}updateJoinPayload(r){this.joinPush.updatePayload(r)}unsubscribe(r=this.timeout){this.state=D.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(W.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(t=>{const n=new Ee(this,W.leave,{},r);n.receive("ok",()=>{e(),t("ok")}).receive("timeout",()=>{e(),t("timed out")}).receive("error",()=>{t("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}_fetchWithTimeout(r,e,t){var n=this;return(0,h.A)(function*(){const i=new AbortController,o=setTimeout(()=>i.abort(),t),a=yield n.socket.fetch(r,Object.assign(Object.assign({},e),{signal:i.signal}));return clearTimeout(o),a})()}_push(r,e,t=this.timeout){if(!this.joinedOnce)throw`tried to push '${r}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Ee(this,r,e,t);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(r,e,t){return e}_isMember(r){return this.topic===r}_joinRef(){return this.joinPush.ref}_trigger(r,e,t){var n,i;const o=r.toLocaleLowerCase(),{close:a,error:l,leave:u,join:c}=W;if(t&&[a,l,u,c].indexOf(o)>=0&&t!==this._joinRef())return;let _=this._onMessage(o,e,t);if(e&&!_)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?null===(n=this.bindings.postgres_changes)||void 0===n||n.filter(m=>{var y,j,E;return"*"===(null===(y=m.filter)||void 0===y?void 0:y.event)||(null===(E=null===(j=m.filter)||void 0===j?void 0:j.event)||void 0===E?void 0:E.toLocaleLowerCase())===o}).map(m=>m.callback(_,t)):null===(i=this.bindings[o])||void 0===i||i.filter(m=>{var y,j,E,H,V,X;if(["broadcast","presence","postgres_changes"].includes(o)){if("id"in m){const Q=m.id,z=null===(y=m.filter)||void 0===y?void 0:y.event;return Q&&(null===(j=e.ids)||void 0===j?void 0:j.includes(Q))&&("*"===z||(null==z?void 0:z.toLocaleLowerCase())===(null===(E=e.data)||void 0===E?void 0:E.type.toLocaleLowerCase()))}{const Q=null===(V=null===(H=null==m?void 0:m.filter)||void 0===H?void 0:H.event)||void 0===V?void 0:V.toLocaleLowerCase();return"*"===Q||Q===(null===(X=null==e?void 0:e.event)||void 0===X?void 0:X.toLocaleLowerCase())}}return m.type.toLocaleLowerCase()===o}).map(m=>{if("object"==typeof _&&"ids"in _){const y=_.data,{schema:j,table:E,commit_timestamp:H,type:V,errors:X}=y;_=Object.assign(Object.assign({},{schema:j,table:E,commit_timestamp:H,eventType:V,new:{},old:{},errors:X}),this._getPayloadRecords(y))}m.callback(_,t)})}_isClosed(){return this.state===D.closed}_isJoined(){return this.state===D.joined}_isJoining(){return this.state===D.joining}_isLeaving(){return this.state===D.leaving}_replyEventName(r){return`chan_reply_${r}`}_on(r,e,t){const n=r.toLocaleLowerCase(),i={type:n,filter:e,callback:t};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(r,e){const t=r.toLocaleLowerCase();return this.bindings[t]=this.bindings[t].filter(n=>{var i;return!((null===(i=n.type)||void 0===i?void 0:i.toLocaleLowerCase())===t&&Pe.isEqual(n.filter,e))}),this}static isEqual(r,e){if(Object.keys(r).length!==Object.keys(e).length)return!1;for(const t in r)if(r[t]!==e[t])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(r){this._on(W.close,{},r)}_onError(r){this._on(W.error,{},e=>r(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(r=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=D.joining,this.joinPush.resend(r))}_getPayloadRecords(r){const e={new:{},old:{}};return("INSERT"===r.type||"UPDATE"===r.type)&&(e.new=Xe(r.columns,r.record)),("UPDATE"===r.type||"DELETE"===r.type)&&(e.old=Xe(r.columns,r.old_record)),e}}const Rt=()=>{},It=typeof WebSocket<"u";class Lt{constructor(r,e){var n,t=this;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=re,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Rt,this.conn=null,this.sendBuffer=[],this.serializer=new At,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=o=>{let a;return a=o||(typeof fetch>"u"?(...l)=>Promise.resolve().then(b.bind(b,5286)).then(({default:u})=>u(...l)):fetch),(...l)=>a(...l)},this.endPoint=`${r}/${Ve.websocket}`,this.httpEndpoint=Ye(r),this.transport=null!=e&&e.transport?e.transport:null,null!=e&&e.params&&(this.params=e.params),null!=e&&e.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),null!=e&&e.timeout&&(this.timeout=e.timeout),null!=e&&e.logger&&(this.logger=e.logger),null!=e&&e.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);const i=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.apikey;if(i&&(this.accessToken=i,this.apiKey=i),this.reconnectAfterMs=null!=e&&e.reconnectAfterMs?e.reconnectAfterMs:o=>[1e3,2e3,5e3,1e4][o-1]||1e4,this.encode=null!=e&&e.encode?e.encode:(o,a)=>a(JSON.stringify(o)),this.decode=null!=e&&e.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Qe((0,h.A)(function*(){t.disconnect(),t.connect()}),this.reconnectAfterMs),this.fetch=this._resolveFetch(null==e?void 0:e.fetch),null!=e&&e.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(null==e?void 0:e.worker)||!1,this.workerUrl=null==e?void 0:e.workerUrl}}connect(){if(!this.conn){if(this.transport)return void(this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers}));if(It)return this.conn=new WebSocket(this._endPointURL()),void this.setupConnection();this.conn=new Dt(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),b.e(8).then(b.t.bind(b,8,23)).then(({default:r})=>{this.conn=new r(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(r,e){this.conn&&(this.conn.onclose=function(){},r?this.conn.close(r,null!=e?e:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(r){var e=this;return(0,h.A)(function*(){const t=yield r.unsubscribe();return 0===e.channels.length&&e.disconnect(),t})()}removeAllChannels(){var r=this;return(0,h.A)(function*(){const e=yield Promise.all(r.channels.map(t=>t.unsubscribe()));return r.disconnect(),e})()}log(r,e,t){this.logger(r,e,t)}connectionState(){switch(this.conn&&this.conn.readyState){case K.connecting:return ce.Connecting;case K.open:return ce.Open;case K.closing:return ce.Closing;default:return ce.Closed}}isConnected(){return this.connectionState()===ce.Open}channel(r,e={config:{}}){const t=new Pe(`realtime:${r}`,e,this);return this.channels.push(t),t}push(r){const{topic:e,event:t,payload:n,ref:i}=r,o=()=>{this.encode(r,a=>{var l;null===(l=this.conn)||void 0===l||l.send(a)})};this.log("push",`${e} ${t} (${i})`,n),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(r){if(r){let e=null;try{e=JSON.parse(atob(r.split(".")[1]))}catch{}if(e&&e.exp&&!(Math.floor(Date.now()/1e3)-e.exp<0))return void this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`)}this.accessToken=r,this.channels.forEach(e=>{r&&e.updateJoinPayload({access_token:r}),e.joinedOnce&&e._isJoined()&&e._push(W.access_token,{access_token:r})})}_makeRef(){let r=this.ref+1;return this.ref=r===this.ref?0:r,this.ref.toString()}_leaveOpenTopic(r){let e=this.channels.find(t=>t.topic===r&&(t._isJoined()||t._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${r}"`),e.unsubscribe())}_remove(r){this.channels=this.channels.filter(e=>e._joinRef()!==r._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=r=>this._onConnError(r),this.conn.onmessage=r=>this._onConnMessage(r),this.conn.onclose=r=>this._onConnClose(r))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}_onConnMessage(r){this.decode(r.data,e=>{let{topic:t,event:n,payload:i,ref:o}=e;(o&&o===this.pendingHeartbeatRef||n===(null==i?void 0:i.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${t} ${n} ${o&&"("+o+")"||""}`,i),this.channels.filter(a=>a._isMember(t)).forEach(a=>a._trigger(n,i,o)),this.stateChangeCallbacks.message.forEach(a=>a(e))})}_onConnOpen(){var r=this;return(0,h.A)(function*(){if(r.log("transport",`connected to ${r._endPointURL()}`),r._flushSendBuffer(),r.reconnectTimer.reset(),r.worker){r.log("worker",r.workerUrl?`starting worker for from ${r.workerUrl}`:"starting default worker");const e=r._workerObjectUrl(r.workerUrl);r.workerRef=new Worker(e),r.workerRef.onerror=t=>{r.log("worker","worker error",t.message),r.workerRef.terminate()},r.workerRef.onmessage=t=>{"keepAlive"===t.data.event&&r._sendHeartbeat()},r.workerRef.postMessage({event:"start",interval:r.heartbeatIntervalMs})}else r.heartbeatTimer&&clearInterval(r.heartbeatTimer),r.heartbeatTimer=setInterval(()=>r._sendHeartbeat(),r.heartbeatIntervalMs);r.stateChangeCallbacks.open.forEach(e=>e())})()}_onConnClose(r){this.log("transport","close",r),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(r))}_onConnError(r){this.log("transport",r.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(r))}_triggerChanError(){this.channels.forEach(r=>r._trigger(W.error))}_appendParams(r,e){if(0===Object.keys(e).length)return r;const t=r.match(/\?/)?"&":"?";return`${r}${t}${new URLSearchParams(e)}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(r=>r()),this.sendBuffer=[])}_sendHeartbeat(){var r;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(r=this.conn)||void 0===r||r.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_workerObjectUrl(r){let e;if(r)e=r;else{const t=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});e=URL.createObjectURL(t)}return e}}class Dt{constructor(r,e,t){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=K.connecting,this.send=()=>{},this.url=null,this.url=r,this.close=t.close}}class je extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}}function L(s){return"object"==typeof s&&null!==s&&"__isStorageError"in s}class Nt extends je{constructor(r,e){super(r),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class xe extends je{constructor(r,e){super(r),this.name="StorageUnknownError",this.originalError=e}}const et=s=>{let r;return r=s||(typeof fetch>"u"?(...e)=>Promise.resolve().then(b.bind(b,5286)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)},$e=s=>{if(Array.isArray(s))return s.map(e=>$e(e));if("function"==typeof s||s!==Object(s))return s;const r={};return Object.entries(s).forEach(([e,t])=>{const n=e.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));r[n]=$e(t)}),r};var ie=function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(c){try{u(t.next(c))}catch(p){o(p)}}function l(c){try{u(t.throw(c))}catch(p){o(p)}}function u(c){c.done?i(c.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(c.value).then(a,l)}u((t=t.apply(s,r||[])).next())})};const Ce=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),Mt=(s,r,e)=>ie(void 0,void 0,void 0,function*(){const t=yield function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(c){try{u(t.next(c))}catch(p){o(p)}}function l(c){try{u(t.throw(c))}catch(p){o(p)}}function u(c){c.done?i(c.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(c.value).then(a,l)}u((t=t.apply(s,r||[])).next())})}(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(b.bind(b,5286))).Response:Response});s instanceof t&&(null==e||!e.noResolveJson)?s.json().then(n=>{r(new Nt(Ce(n),s.status||500))}).catch(n=>{r(new xe(Ce(n),n))}):r(new xe(Ce(s),s))}),zt=(s,r,e,t)=>{const n={method:s,headers:(null==r?void 0:r.headers)||{}};return"GET"===s?n:(n.headers=Object.assign({"Content-Type":"application/json"},null==r?void 0:r.headers),t&&(n.body=JSON.stringify(t)),Object.assign(Object.assign({},n),e))};function pe(s,r,e,t,n,i){return ie(this,void 0,void 0,function*(){return new Promise((o,a)=>{s(e,zt(r,t,n,i)).then(l=>{if(!l.ok)throw l;return null!=t&&t.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>Mt(l,a,t))})})}function me(s,r,e,t){return ie(this,void 0,void 0,function*(){return pe(s,"GET",r,e,t)})}function Z(s,r,e,t,n){return ie(this,void 0,void 0,function*(){return pe(s,"POST",r,t,n,e)})}function Jt(s,r,e,t,n){return ie(this,void 0,void 0,function*(){return pe(s,"PUT",r,t,n,e)})}function tt(s,r,e,t,n){return ie(this,void 0,void 0,function*(){return pe(s,"DELETE",r,t,n,e)})}var M=function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(c){try{u(t.next(c))}catch(p){o(p)}}function l(c){try{u(t.throw(c))}catch(p){o(p)}}function u(c){c.done?i(c.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(c.value).then(a,l)}u((t=t.apply(s,r||[])).next())})};const Ht={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},rt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class qt{constructor(r,e={},t,n){this.url=r,this.headers=e,this.bucketId=t,this.fetch=et(n)}uploadOrUpdate(r,e,t,n){return M(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},rt),n);let a=Object.assign(Object.assign({},this.headers),"POST"===r&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&t instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",t)):typeof FormData<"u"&&t instanceof FormData?(i=t,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=t,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),null!=n&&n.headers&&(a=Object.assign(Object.assign({},a),n.headers));const u=this._removeEmptyFolders(e),c=this._getFinalPath(u),p=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:r,body:i,headers:a},null!=o&&o.duplex?{duplex:o.duplex}:{})),_=yield p.json();return p.ok?{data:{path:u,id:_.Id,fullPath:_.Key},error:null}:{data:null,error:_}}catch(i){if(L(i))return{data:null,error:i};throw i}})}upload(r,e,t){return M(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",r,e,t)})}uploadToSignedUrl(r,e,t,n){return M(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(r),o=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let l;const u=Object.assign({upsert:rt.upsert},n),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&t instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",t)):typeof FormData<"u"&&t instanceof FormData?(l=t,l.append("cacheControl",u.cacheControl)):(l=t,c["cache-control"]=`max-age=${u.cacheControl}`,c["content-type"]=u.contentType);const p=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:c}),_=yield p.json();return p.ok?{data:{path:i,fullPath:_.Key},error:null}:{data:null,error:_}}catch(l){if(L(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(r,e){return M(this,void 0,void 0,function*(){try{let t=this._getFinalPath(r);const n=Object.assign({},this.headers);null!=e&&e.upsert&&(n["x-upsert"]="true");const i=yield Z(this.fetch,`${this.url}/object/upload/sign/${t}`,{},{headers:n}),o=new URL(this.url+i.url),a=o.searchParams.get("token");if(!a)throw new je("No token returned by API");return{data:{signedUrl:o.toString(),path:r,token:a},error:null}}catch(t){if(L(t))return{data:null,error:t};throw t}})}update(r,e,t){return M(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",r,e,t)})}move(r,e,t){return M(this,void 0,void 0,function*(){try{return{data:yield Z(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:r,destinationKey:e,destinationBucket:null==t?void 0:t.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(L(n))return{data:null,error:n};throw n}})}copy(r,e,t){return M(this,void 0,void 0,function*(){try{return{data:{path:(yield Z(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:r,destinationKey:e,destinationBucket:null==t?void 0:t.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(L(n))return{data:null,error:n};throw n}})}createSignedUrl(r,e,t){return M(this,void 0,void 0,function*(){try{let n=this._getFinalPath(r),i=yield Z(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:e},null!=t&&t.transform?{transform:t.transform}:{}),{headers:this.headers});const o=null!=t&&t.download?`&download=${!0===t.download?"":t.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(n){if(L(n))return{data:null,error:n};throw n}})}createSignedUrls(r,e,t){return M(this,void 0,void 0,function*(){try{const n=yield Z(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:r},{headers:this.headers}),i=null!=t&&t.download?`&download=${!0===t.download?"":t.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(n){if(L(n))return{data:null,error:n};throw n}})}download(r,e){return M(this,void 0,void 0,function*(){const n=typeof(null==e?void 0:e.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((null==e?void 0:e.transform)||{}),o=i?`?${i}`:"";try{const a=this._getFinalPath(r);return{data:yield(yield me(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(L(a))return{data:null,error:a};throw a}})}info(r){return M(this,void 0,void 0,function*(){const e=this._getFinalPath(r);try{const t=yield me(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:$e(t),error:null}}catch(t){if(L(t))return{data:null,error:t};throw t}})}exists(r){return M(this,void 0,void 0,function*(){const e=this._getFinalPath(r);try{return yield function Gt(s,r,e,t){return ie(this,void 0,void 0,function*(){return pe(s,"HEAD",r,Object.assign(Object.assign({},e),{noResolveJson:!0}),t)})}(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(t){if(L(t)&&t instanceof xe){const n=t.originalError;if([400,404].includes(null==n?void 0:n.status))return{data:!1,error:t}}throw t}})}getPublicUrl(r,e){const t=this._getFinalPath(r),n=[],i=null!=e&&e.download?`download=${!0===e.download?"":e.download}`:"";""!==i&&n.push(i);const a=typeof(null==e?void 0:e.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((null==e?void 0:e.transform)||{});""!==l&&n.push(l);let u=n.join("&");return""!==u&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${t}${u}`)}}}remove(r){return M(this,void 0,void 0,function*(){try{return{data:yield tt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:r},{headers:this.headers}),error:null}}catch(e){if(L(e))return{data:null,error:e};throw e}})}list(r,e,t){return M(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Ht),e),{prefix:r||""});return{data:yield Z(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(L(n))return{data:null,error:n};throw n}})}encodeMetadata(r){return JSON.stringify(r)}toBase64(r){return typeof Buffer<"u"?Buffer.from(r).toString("base64"):btoa(r)}_getFinalPath(r){return`${this.bucketId}/${r}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){const e=[];return r.width&&e.push(`width=${r.width}`),r.height&&e.push(`height=${r.height}`),r.resize&&e.push(`resize=${r.resize}`),r.format&&e.push(`format=${r.format}`),r.quality&&e.push(`quality=${r.quality}`),e.join("&")}}const Kt={"X-Client-Info":"storage-js/2.7.1"};var ue=function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(c){try{u(t.next(c))}catch(p){o(p)}}function l(c){try{u(t.throw(c))}catch(p){o(p)}}function u(c){c.done?i(c.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(c.value).then(a,l)}u((t=t.apply(s,r||[])).next())})};class Wt{constructor(r,e={},t){this.url=r,this.headers=Object.assign(Object.assign({},Kt),e),this.fetch=et(t)}listBuckets(){return ue(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(r){if(L(r))return{data:null,error:r};throw r}})}getBucket(r){return ue(this,void 0,void 0,function*(){try{return{data:yield me(this.fetch,`${this.url}/bucket/${r}`,{headers:this.headers}),error:null}}catch(e){if(L(e))return{data:null,error:e};throw e}})}createBucket(r,e={public:!1}){return ue(this,void 0,void 0,function*(){try{return{data:yield Z(this.fetch,`${this.url}/bucket`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(t){if(L(t))return{data:null,error:t};throw t}})}updateBucket(r,e){return ue(this,void 0,void 0,function*(){try{return{data:yield Jt(this.fetch,`${this.url}/bucket/${r}`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(t){if(L(t))return{data:null,error:t};throw t}})}emptyBucket(r){return ue(this,void 0,void 0,function*(){try{return{data:yield Z(this.fetch,`${this.url}/bucket/${r}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(L(e))return{data:null,error:e};throw e}})}deleteBucket(r){return ue(this,void 0,void 0,function*(){try{return{data:yield tt(this.fetch,`${this.url}/bucket/${r}`,{},{headers:this.headers}),error:null}}catch(e){if(L(e))return{data:null,error:e};throw e}})}}class Vt extends Wt{constructor(r,e={},t){super(r,e,t)}from(r){return new qt(this.url,this.headers,r,this.fetch)}}let ge="";ge=typeof Deno<"u"?"deno":typeof document<"u"?"web":typeof navigator<"u"&&"ReactNative"===navigator.product?"react-native":"node";const Xt={headers:{"X-Client-Info":`supabase-js-${ge}/2.47.2`}},Zt={schema:"public"},Yt={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},er={};var nt=b(5286);const sr=(s,r,e)=>{const t=(s=>{let r;return r=s||(typeof fetch>"u"?nt.default:fetch),(...e)=>r(...e)})(e),n=typeof Headers>"u"?nt.Headers:Headers;return(i,o)=>function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(c){try{u(t.next(c))}catch(p){o(p)}}function l(c){try{u(t.throw(c))}catch(p){o(p)}}function u(c){c.done?i(c.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(c.value).then(a,l)}u((t=t.apply(s,r||[])).next())})}(void 0,void 0,void 0,function*(){var a;const l=null!==(a=yield r())&&void 0!==a?a:s;let u=new n(null==o?void 0:o.headers);return u.has("apikey")||u.set("apikey",s),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),t(i,Object.assign(Object.assign({},o),{headers:u}))})};const Re="X-Supabase-Api-Version",ot={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},G=()=>typeof document<"u",oe={tested:!1,writable:!1},_e=()=>{if(!G())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch{return!1}if(oe.tested)return oe.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),oe.tested=!0,oe.writable=!0}catch{oe.tested=!0,oe.writable=!1}return oe.writable};function Ie(s){const r={},e=new URL(s);if(e.hash&&"#"===e.hash[0])try{new URLSearchParams(e.hash.substring(1)).forEach((n,i)=>{r[i]=n})}catch{}return e.searchParams.forEach((t,n)=>{r[n]=t}),r}const at=s=>{let r;return r=s||(typeof fetch>"u"?(...e)=>Promise.resolve().then(b.bind(b,5286)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)},fr=s=>"object"==typeof s&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json,lt=function(){var s=(0,h.A)(function*(r,e,t){yield r.setItem(e,JSON.stringify(t))});return function(e,t,n){return s.apply(this,arguments)}}(),be=function(){var s=(0,h.A)(function*(r,e){const t=yield r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}});return function(e,t){return s.apply(this,arguments)}}(),we=function(){var s=(0,h.A)(function*(r,e){yield r.removeItem(e)});return function(e,t){return s.apply(this,arguments)}}();class Ae{constructor(){this.promise=new Ae.promiseConstructor((r,e)=>{this.resolve=r,this.reject=e})}}function ct(s){const e=s.split(".");if(3!==e.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");return JSON.parse(function pr(s){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t,n,i,o,a,l,u,e="",c=0;for(s=s.replace("-","+").replace("_","/");c<s.length;)o=r.indexOf(s.charAt(c++)),a=r.indexOf(s.charAt(c++)),l=r.indexOf(s.charAt(c++)),u=r.indexOf(s.charAt(c++)),t=o<<2|a>>4,n=(15&a)<<4|l>>2,i=(3&l)<<6|u,e+=String.fromCharCode(t),64!=l&&0!=n&&(e+=String.fromCharCode(n)),64!=u&&0!=i&&(e+=String.fromCharCode(i));return e}(e[1]))}function Ue(){return(Ue=(0,h.A)(function*(s){return yield new Promise(r=>{setTimeout(()=>r(null),s)})})).apply(this,arguments)}function vr(s){return("0"+s.toString(16)).substr(-2)}function Le(){return(Le=(0,h.A)(function*(s){const e=(new TextEncoder).encode(s),t=yield crypto.subtle.digest("SHA-256",e),n=new Uint8Array(t);return Array.from(n).map(i=>String.fromCharCode(i)).join("")})).apply(this,arguments)}function De(){return De=(0,h.A)(function*(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const e=yield function mr(s){return Le.apply(this,arguments)}(s);return function br(s){return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(e)}),De.apply(this,arguments)}function he(s,r){return Ne.apply(this,arguments)}function Ne(){return Ne=(0,h.A)(function*(s,r,e=!1){const t=function yr(){const r=new Uint32Array(56);if(typeof crypto>"u"){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let n="";for(let i=0;i<56;i++)n+=e.charAt(Math.floor(Math.random()*t));return n}return crypto.getRandomValues(r),Array.from(r,vr).join("")}();let n=t;e&&(n+="/PASSWORD_RECOVERY"),yield lt(s,`${r}-code-verifier`,n);const i=yield function wr(s){return De.apply(this,arguments)}(t);return[i,t===i?"plain":"s256"]}),Ne.apply(this,arguments)}Ae.promiseConstructor=Promise;const Ar=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;class Be extends Error{constructor(r,e,t){super(r),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=t}}function k(s){return"object"==typeof s&&null!==s&&"__isAuthError"in s}class Sr extends Be{constructor(r,e,t){super(r,e,t),this.name="AuthApiError",this.status=e,this.code=t}}class ut extends Be{constructor(r,e){super(r),this.name="AuthUnknownError",this.originalError=e}}class ae extends Be{constructor(r,e,t,n){super(r,t,n),this.name=e,this.status=t}}class Y extends ae{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Fe extends ae{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ke extends ae{constructor(r){super(r,"AuthInvalidCredentialsError",400,void 0)}}class Se extends ae{constructor(r,e=null){super(r,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ht extends ae{constructor(r,e=null){super(r,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Me extends ae{constructor(r,e){super(r,"AuthRetryableFetchError",e,void 0)}}function ze(s){return k(s)&&"AuthRetryableFetchError"===s.name}class dt extends ae{constructor(r,e,t){super(r,"AuthWeakPasswordError",e,"weak_password"),this.reasons=t}}const le=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),jr=[502,503,504];function ft(s){return Je.apply(this,arguments)}function Je(){return(Je=(0,h.A)(function*(s){var r;if(!fr(s))throw new Me(le(s),0);if(jr.includes(s.status))throw new Me(le(s),s.status);let e,t;try{e=yield s.json()}catch(i){throw new ut(le(i),i)}const n=function kr(s){const r=s.headers.get(Re);if(!r||!r.match(Ar))return null;try{return new Date(`${r}T00:00:00.0Z`)}catch{return null}}(s);if(n&&n.getTime()>=ot["2024-01-01"].timestamp&&"object"==typeof e&&e&&"string"==typeof e.code?t=e.code:"object"==typeof e&&e&&"string"==typeof e.error_code&&(t=e.error_code),t){if("weak_password"===t)throw new dt(le(e),s.status,(null===(r=e.weak_password)||void 0===r?void 0:r.reasons)||[]);if("session_not_found"===t)throw new Y}else if("object"==typeof e&&e&&"object"==typeof e.weak_password&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((i,o)=>i&&"string"==typeof o,!0))throw new dt(le(e),s.status,e.weak_password.reasons);throw new Sr(le(e),s.status||500,t)})).apply(this,arguments)}const xr=(s,r,e,t)=>{const n={method:s,headers:(null==r?void 0:r.headers)||{}};return"GET"===s?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==r?void 0:r.headers),n.body=JSON.stringify(t),Object.assign(Object.assign({},n),e))};function T(s,r,e,t){return Ge.apply(this,arguments)}function Ge(){return Ge=(0,h.A)(function*(s,r,e,t){var n;const i=Object.assign({},null==t?void 0:t.headers);i[Re]||(i[Re]=ot["2024-01-01"].name),null!=t&&t.jwt&&(i.Authorization=`Bearer ${t.jwt}`);const o=null!==(n=null==t?void 0:t.query)&&void 0!==n?n:{};null!=t&&t.redirectTo&&(o.redirect_to=t.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=yield function $r(s,r,e,t,n,i){return He.apply(this,arguments)}(s,r,e+a,{headers:i,noResolveJson:null==t?void 0:t.noResolveJson},{},null==t?void 0:t.body);return null!=t&&t.xform?null==t?void 0:t.xform(l):{data:Object.assign({},l),error:null}}),Ge.apply(this,arguments)}function He(){return(He=(0,h.A)(function*(s,r,e,t,n,i){const o=xr(r,t,n,i);let a;try{a=yield s(e,Object.assign({},o))}catch(l){throw console.error(l),new Me(le(l),0)}if(a.ok||(yield ft(a)),null!=t&&t.noResolveJson)return a;try{return yield a.json()}catch(l){yield ft(l)}})).apply(this,arguments)}function ee(s){var r;let e=null;return function Ur(s){return s.access_token&&s.refresh_token&&s.expires_in}(s)&&(e=Object.assign({},s),s.expires_at||(e.expires_at=function hr(s){return Math.round(Date.now()/1e3)+s}(s.expires_in))),{data:{session:e,user:null!==(r=s.user)&&void 0!==r?r:s},error:null}}function pt(s){const r=ee(s);return!r.error&&s.weak_password&&"object"==typeof s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&"string"==typeof s.weak_password.message&&s.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(r.data.weak_password=s.weak_password),r}function te(s){var r;return{data:{user:null!==(r=s.user)&&void 0!==r?r:s},error:null}}function Cr(s){return{data:s,error:null}}function Rr(s){const{action_link:r,email_otp:e,hashed_token:t,redirect_to:n,verification_type:i}=s,o=function(s,r){var e={};for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&r.indexOf(t)<0&&(e[t]=s[t]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(t=Object.getOwnPropertySymbols(s);n<t.length;n++)r.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(s,t[n])&&(e[t[n]]=s[t[n]])}return e}(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:r,email_otp:e,hashed_token:t,redirect_to:n,verification_type:i},user:Object.assign({},o)},error:null}}function Ir(s){return s}class Dr{constructor({url:r="",headers:e={},fetch:t}){this.url=r,this.headers=e,this.fetch=at(t),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(r,e="global"){var t=this;return(0,h.A)(function*(){try{return yield T(t.fetch,"POST",`${t.url}/logout?scope=${e}`,{headers:t.headers,jwt:r,noResolveJson:!0}),{data:null,error:null}}catch(n){if(k(n))return{data:null,error:n};throw n}})()}inviteUserByEmail(r,e={}){var t=this;return(0,h.A)(function*(){try{return yield T(t.fetch,"POST",`${t.url}/invite`,{body:{email:r,data:e.data},headers:t.headers,redirectTo:e.redirectTo,xform:te})}catch(n){if(k(n))return{data:{user:null},error:n};throw n}})()}generateLink(r){var e=this;return(0,h.A)(function*(){try{const{options:t}=r,n=function(s,r){var e={};for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&r.indexOf(t)<0&&(e[t]=s[t]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(t=Object.getOwnPropertySymbols(s);n<t.length;n++)r.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(s,t[n])&&(e[t[n]]=s[t[n]])}return e}(r,["options"]),i=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(i.new_email=null==n?void 0:n.newEmail,delete i.newEmail),yield T(e.fetch,"POST",`${e.url}/admin/generate_link`,{body:i,headers:e.headers,xform:Rr,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(k(t))return{data:{properties:null,user:null},error:t};throw t}})()}createUser(r){var e=this;return(0,h.A)(function*(){try{return yield T(e.fetch,"POST",`${e.url}/admin/users`,{body:r,headers:e.headers,xform:te})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}})()}listUsers(r){var e=this;return(0,h.A)(function*(){var t,n,i,o,a,l,u;try{const c={nextPage:null,lastPage:0,total:0},p=yield T(e.fetch,"GET",`${e.url}/admin/users`,{headers:e.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null==r?void 0:r.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(o=null===(i=null==r?void 0:r.perPage)||void 0===i?void 0:i.toString())&&void 0!==o?o:""},xform:Ir});if(p.error)throw p.error;const _=yield p.json(),m=null!==(a=p.headers.get("x-total-count"))&&void 0!==a?a:0,y=null!==(u=null===(l=p.headers.get("link"))||void 0===l?void 0:l.split(","))&&void 0!==u?u:[];return y.length>0&&(y.forEach(j=>{const E=parseInt(j.split(";")[0].split("=")[1].substring(0,1)),H=JSON.parse(j.split(";")[1].split("=")[1]);c[`${H}Page`]=E}),c.total=parseInt(m)),{data:Object.assign(Object.assign({},_),c),error:null}}catch(c){if(k(c))return{data:{users:[]},error:c};throw c}})()}getUserById(r){var e=this;return(0,h.A)(function*(){try{return yield T(e.fetch,"GET",`${e.url}/admin/users/${r}`,{headers:e.headers,xform:te})}catch(t){if(k(t))return{data:{user:null},error:t};throw t}})()}updateUserById(r,e){var t=this;return(0,h.A)(function*(){try{return yield T(t.fetch,"PUT",`${t.url}/admin/users/${r}`,{body:e,headers:t.headers,xform:te})}catch(n){if(k(n))return{data:{user:null},error:n};throw n}})()}deleteUser(r,e=!1){var t=this;return(0,h.A)(function*(){try{return yield T(t.fetch,"DELETE",`${t.url}/admin/users/${r}`,{headers:t.headers,body:{should_soft_delete:e},xform:te})}catch(n){if(k(n))return{data:{user:null},error:n};throw n}})()}_listFactors(r){var e=this;return(0,h.A)(function*(){try{const{data:t,error:n}=yield T(e.fetch,"GET",`${e.url}/admin/users/${r.userId}/factors`,{headers:e.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:n}}catch(t){if(k(t))return{data:null,error:t};throw t}})()}_deleteFactor(r){var e=this;return(0,h.A)(function*(){try{return{data:yield T(e.fetch,"DELETE",`${e.url}/admin/users/${r.userId}/factors/${r.id}`,{headers:e.headers}),error:null}}catch(t){if(k(t))return{data:null,error:t};throw t}})()}}const Nr={getItem:s=>_e()?globalThis.localStorage.getItem(s):null,setItem:(s,r)=>{_e()&&globalThis.localStorage.setItem(s,r)},removeItem:s=>{_e()&&globalThis.localStorage.removeItem(s)}};function gt(s={}){return{getItem:r=>s[r]||null,setItem:(r,e)=>{s[r]=e},removeItem:r=>{delete s[r]}}}const de={debug:!!(globalThis&&_e()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"))};class _t extends Error{constructor(r){super(r),this.isAcquireTimeout=!0}}class Fr extends _t{}function zr(s,r,e){return qe.apply(this,arguments)}function qe(){return qe=(0,h.A)(function*(s,r,e){de.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,r);const t=new globalThis.AbortController;return r>0&&setTimeout(()=>{t.abort(),de.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},r),yield globalThis.navigator.locks.request(s,0===r?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:t.signal},function(){var n=(0,h.A)(function*(i){if(!i){if(0===r)throw de.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new Fr(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(de.debug)try{const o=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield e()}de.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,i.name);try{return yield e()}finally{de.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,i.name)}});return function(i){return n.apply(this,arguments)}}())}),qe.apply(this,arguments)}!function Br(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}();const Jr={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:{"X-Client-Info":"gotrue-js/2.66.1"},flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},ve=3e4;function mt(s,r,e){return We.apply(this,arguments)}function We(){return(We=(0,h.A)(function*(s,r,e){return yield e()})).apply(this,arguments)}const Hr=(()=>{class s{constructor(e){var n,i,t=this;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=s.nextInstanceID,s.nextInstanceID+=1,this.instanceID>0&&G()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const o=Object.assign(Object.assign({},Jr),e);if(this.logDebugMessages=!!o.debug,"function"==typeof o.debug&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new Dr({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=at(o.fetch),this.lock=o.lock||mt,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,this.lock=o.lock?o.lock:G()&&null!==(n=null==globalThis?void 0:globalThis.navigator)&&void 0!==n&&n.locks?zr:mt,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?o.storage?this.storage=o.storage:_e()?this.storage=Nr:(this.memoryStorage={},this.storage=gt(this.memoryStorage)):(this.memoryStorage={},this.storage=gt(this.memoryStorage)),G()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}null===(i=this.broadcastChannel)||void 0===i||i.addEventListener("message",function(){var a=(0,h.A)(function*(l){t._debug("received broadcast notification from other tab or client",l),yield t._notifyAllSubscribers(l.data.event,l.data.session,!1)});return function(l){return a.apply(this,arguments)}}())}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (2.66.1) ${(new Date).toISOString()}`,...e),this}initialize(){var e=this;return(0,h.A)(function*(){return e.initializePromise||(e.initializePromise=(0,h.A)(function*(){return yield e._acquireLock(-1,(0,h.A)(function*(){return yield e._initialize()}))})()),yield e.initializePromise})()}_initialize(){var e=this;return(0,h.A)(function*(){var t;try{const n=!!G()&&(yield e._isPKCEFlow());if(e._debug("#_initialize()","begin","is PKCE flow",n),n||e.detectSessionInUrl&&e._isImplicitGrantFlow()){const{data:i,error:o}=yield e._getSessionFromURL(n);if(o){if(e._debug("#_initialize()","error detecting session from URL",o),function Er(s){return k(s)&&"AuthImplicitGrantRedirectError"===s.name}(o)){const u=null===(t=o.details)||void 0===t?void 0:t.code;if("identity_already_exists"===u||"identity_not_found"===u||"single_identity_not_deletable"===u)return{error:o}}return yield e._removeSession(),{error:o}}const{session:a,redirectType:l}=i;return e._debug("#_initialize()","detected session in URL",a,"redirect type",l),yield e._saveSession(a),setTimeout((0,h.A)(function*(){"recovery"===l?yield e._notifyAllSubscribers("PASSWORD_RECOVERY",a):yield e._notifyAllSubscribers("SIGNED_IN",a)}),0),{error:null}}return yield e._recoverAndRefresh(),{error:null}}catch(n){return k(n)?{error:n}:{error:new ut("Unexpected error during initialization",n)}}finally{yield e._handleVisibilityChange(),e._debug("#_initialize()","end")}})()}signInAnonymously(e){var t=this;return(0,h.A)(function*(){var n,i,o;try{const a=yield T(t.fetch,"POST",`${t.url}/signup`,{headers:t.headers,body:{data:null!==(i=null===(n=null==e?void 0:e.options)||void 0===n?void 0:n.data)&&void 0!==i?i:{},gotrue_meta_security:{captcha_token:null===(o=null==e?void 0:e.options)||void 0===o?void 0:o.captchaToken}},xform:ee}),{data:l,error:u}=a;if(u||!l)return{data:{user:null,session:null},error:u};const c=l.session,p=l.user;return l.session&&(yield t._saveSession(l.session),yield t._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:p,session:c},error:null}}catch(a){if(k(a))return{data:{user:null,session:null},error:a};throw a}})()}signUp(e){var t=this;return(0,h.A)(function*(){var n,i,o;try{let a;if("email"in e){const{email:_,password:m,options:y}=e;let j=null,E=null;"pkce"===t.flowType&&([j,E]=yield he(t.storage,t.storageKey)),a=yield T(t.fetch,"POST",`${t.url}/signup`,{headers:t.headers,redirectTo:null==y?void 0:y.emailRedirectTo,body:{email:_,password:m,data:null!==(n=null==y?void 0:y.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null==y?void 0:y.captchaToken},code_challenge:j,code_challenge_method:E},xform:ee})}else{if(!("phone"in e))throw new ke("You must provide either an email or phone number and a password");{const{phone:_,password:m,options:y}=e;a=yield T(t.fetch,"POST",`${t.url}/signup`,{headers:t.headers,body:{phone:_,password:m,data:null!==(i=null==y?void 0:y.data)&&void 0!==i?i:{},channel:null!==(o=null==y?void 0:y.channel)&&void 0!==o?o:"sms",gotrue_meta_security:{captcha_token:null==y?void 0:y.captchaToken}},xform:ee})}}const{data:l,error:u}=a;if(u||!l)return{data:{user:null,session:null},error:u};const c=l.session,p=l.user;return l.session&&(yield t._saveSession(l.session),yield t._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:p,session:c},error:null}}catch(a){if(k(a))return{data:{user:null,session:null},error:a};throw a}})()}signInWithPassword(e){var t=this;return(0,h.A)(function*(){try{let n;if("email"in e){const{email:a,password:l,options:u}=e;n=yield T(t.fetch,"POST",`${t.url}/token?grant_type=password`,{headers:t.headers,body:{email:a,password:l,gotrue_meta_security:{captcha_token:null==u?void 0:u.captchaToken}},xform:pt})}else{if(!("phone"in e))throw new ke("You must provide either an email or phone number and a password");{const{phone:a,password:l,options:u}=e;n=yield T(t.fetch,"POST",`${t.url}/token?grant_type=password`,{headers:t.headers,body:{phone:a,password:l,gotrue_meta_security:{captcha_token:null==u?void 0:u.captchaToken}},xform:pt})}}const{data:i,error:o}=n;return o?{data:{user:null,session:null},error:o}:i&&i.session&&i.user?(i.session&&(yield t._saveSession(i.session),yield t._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:o}):{data:{user:null,session:null},error:new Fe}}catch(n){if(k(n))return{data:{user:null,session:null},error:n};throw n}})()}signInWithOAuth(e){var t=this;return(0,h.A)(function*(){var n,i,o,a;return yield t._handleProviderSignIn(e.provider,{redirectTo:null===(n=e.options)||void 0===n?void 0:n.redirectTo,scopes:null===(i=e.options)||void 0===i?void 0:i.scopes,queryParams:null===(o=e.options)||void 0===o?void 0:o.queryParams,skipBrowserRedirect:null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect})})()}exchangeCodeForSession(e){var t=this;return(0,h.A)(function*(){return yield t.initializePromise,t._acquireLock(-1,(0,h.A)(function*(){return t._exchangeCodeForSession(e)}))})()}_exchangeCodeForSession(e){var t=this;return(0,h.A)(function*(){const n=yield be(t.storage,`${t.storageKey}-code-verifier`),[i,o]=(null!=n?n:"").split("/");try{const{data:a,error:l}=yield T(t.fetch,"POST",`${t.url}/token?grant_type=pkce`,{headers:t.headers,body:{auth_code:e,code_verifier:i},xform:ee});if(yield we(t.storage,`${t.storageKey}-code-verifier`),l)throw l;return a&&a.session&&a.user?(a.session&&(yield t._saveSession(a.session),yield t._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign(Object.assign({},a),{redirectType:null!=o?o:null}),error:l}):{data:{user:null,session:null,redirectType:null},error:new Fe}}catch(a){if(k(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}})()}signInWithIdToken(e){var t=this;return(0,h.A)(function*(){try{const{options:n,provider:i,token:o,access_token:a,nonce:l}=e,u=yield T(t.fetch,"POST",`${t.url}/token?grant_type=id_token`,{headers:t.headers,body:{provider:i,id_token:o,access_token:a,nonce:l,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ee}),{data:c,error:p}=u;return p?{data:{user:null,session:null},error:p}:c&&c.session&&c.user?(c.session&&(yield t._saveSession(c.session),yield t._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:p}):{data:{user:null,session:null},error:new Fe}}catch(n){if(k(n))return{data:{user:null,session:null},error:n};throw n}})()}signInWithOtp(e){var t=this;return(0,h.A)(function*(){var n,i,o,a,l;try{if("email"in e){const{email:u,options:c}=e;let p=null,_=null;"pkce"===t.flowType&&([p,_]=yield he(t.storage,t.storageKey));const{error:m}=yield T(t.fetch,"POST",`${t.url}/otp`,{headers:t.headers,body:{email:u,data:null!==(n=null==c?void 0:c.data)&&void 0!==n?n:{},create_user:null===(i=null==c?void 0:c.shouldCreateUser)||void 0===i||i,gotrue_meta_security:{captcha_token:null==c?void 0:c.captchaToken},code_challenge:p,code_challenge_method:_},redirectTo:null==c?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:m}}if("phone"in e){const{phone:u,options:c}=e,{data:p,error:_}=yield T(t.fetch,"POST",`${t.url}/otp`,{headers:t.headers,body:{phone:u,data:null!==(o=null==c?void 0:c.data)&&void 0!==o?o:{},create_user:null===(a=null==c?void 0:c.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null==c?void 0:c.captchaToken},channel:null!==(l=null==c?void 0:c.channel)&&void 0!==l?l:"sms"}});return{data:{user:null,session:null,messageId:null==p?void 0:p.message_id},error:_}}throw new ke("You must provide either an email or phone number.")}catch(u){if(k(u))return{data:{user:null,session:null},error:u};throw u}})()}verifyOtp(e){var t=this;return(0,h.A)(function*(){var n,i;try{let o,a;"options"in e&&(o=null===(n=e.options)||void 0===n?void 0:n.redirectTo,a=null===(i=e.options)||void 0===i?void 0:i.captchaToken);const{data:l,error:u}=yield T(t.fetch,"POST",`${t.url}/verify`,{headers:t.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:o,xform:ee});if(u)throw u;if(!l)throw new Error("An error occurred on token verification.");const c=l.session,p=l.user;return null!=c&&c.access_token&&(yield t._saveSession(c),yield t._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:p,session:c},error:null}}catch(o){if(k(o))return{data:{user:null,session:null},error:o};throw o}})()}signInWithSSO(e){var t=this;return(0,h.A)(function*(){var n,i,o;try{let a=null,l=null;return"pkce"===t.flowType&&([a,l]=yield he(t.storage,t.storageKey)),yield T(t.fetch,"POST",`${t.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(i=null===(n=e.options)||void 0===n?void 0:n.redirectTo)&&void 0!==i?i:void 0}),null!==(o=null==e?void 0:e.options)&&void 0!==o&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:t.headers,xform:Cr})}catch(a){if(k(a))return{data:null,error:a};throw a}})()}reauthenticate(){var e=this;return(0,h.A)(function*(){return yield e.initializePromise,yield e._acquireLock(-1,(0,h.A)(function*(){return yield e._reauthenticate()}))})()}_reauthenticate(){var e=this;return(0,h.A)(function*(){try{return yield e._useSession(function(){var t=(0,h.A)(function*(n){const{data:{session:i},error:o}=n;if(o)throw o;if(!i)throw new Y;const{error:a}=yield T(e.fetch,"GET",`${e.url}/reauthenticate`,{headers:e.headers,jwt:i.access_token});return{data:{user:null,session:null},error:a}});return function(n){return t.apply(this,arguments)}}())}catch(t){if(k(t))return{data:{user:null,session:null},error:t};throw t}})()}resend(e){var t=this;return(0,h.A)(function*(){try{const n=`${t.url}/resend`;if("email"in e){const{email:i,type:o,options:a}=e,{error:l}=yield T(t.fetch,"POST",n,{headers:t.headers,body:{email:i,type:o,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:l}}if("phone"in e){const{phone:i,type:o,options:a}=e,{data:l,error:u}=yield T(t.fetch,"POST",n,{headers:t.headers,body:{phone:i,type:o,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:null==l?void 0:l.message_id},error:u}}throw new ke("You must provide either an email or phone number and a type")}catch(n){if(k(n))return{data:{user:null,session:null},error:n};throw n}})()}getSession(){var e=this;return(0,h.A)(function*(){return yield e.initializePromise,yield e._acquireLock(-1,(0,h.A)(function*(){return e._useSession(function(){var n=(0,h.A)(function*(i){return i});return function(i){return n.apply(this,arguments)}}())}))})()}_acquireLock(e,t){var n=this;return(0,h.A)(function*(){n._debug("#_acquireLock","begin",e);try{if(n.lockAcquired){const i=n.pendingInLock.length?n.pendingInLock[n.pendingInLock.length-1]:Promise.resolve(),o=(0,h.A)(function*(){return yield i,yield t()})();return n.pendingInLock.push((0,h.A)(function*(){try{yield o}catch{}})()),o}return yield n.lock(`lock:${n.storageKey}`,e,(0,h.A)(function*(){n._debug("#_acquireLock","lock acquired for storage key",n.storageKey);try{n.lockAcquired=!0;const i=t();for(n.pendingInLock.push((0,h.A)(function*(){try{yield i}catch{}})()),yield i;n.pendingInLock.length;){const o=[...n.pendingInLock];yield Promise.all(o),n.pendingInLock.splice(0,o.length)}return yield i}finally{n._debug("#_acquireLock","lock released for storage key",n.storageKey),n.lockAcquired=!1}}))}finally{n._debug("#_acquireLock","end")}})()}_useSession(e){var t=this;return(0,h.A)(function*(){t._debug("#_useSession","begin");try{const n=yield t.__loadSession();return yield e(n)}finally{t._debug("#_useSession","end")}})()}__loadSession(){var e=this;return(0,h.A)(function*(){e._debug("#__loadSession()","begin"),e.lockAcquired||e._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let t=null;const n=yield be(e.storage,e.storageKey);if(e._debug("#getSession()","session from storage",n),null!==n&&(e._isValidSession(n)?t=n:(e._debug("#getSession()","session from storage is not valid"),yield e._removeSession())),!t)return{data:{session:null},error:null};const i=!!t.expires_at&&t.expires_at<=Date.now()/1e3;if(e._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",t.expires_at),!i){if(e.storage.isServer){let l=e.suppressGetSessionWarning;t=new Proxy(t,{get:(c,p,_)=>(!l&&"user"===p&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),l=!0,e.suppressGetSessionWarning=!0),Reflect.get(c,p,_))})}return{data:{session:t},error:null}}const{session:o,error:a}=yield e._callRefreshToken(t.refresh_token);return a?{data:{session:null},error:a}:{data:{session:o},error:null}}finally{e._debug("#__loadSession()","end")}})()}getUser(e){var t=this;return(0,h.A)(function*(){return e?yield t._getUser(e):(yield t.initializePromise,yield t._acquireLock(-1,(0,h.A)(function*(){return yield t._getUser()})))})()}_getUser(e){var t=this;return(0,h.A)(function*(){try{return e?yield T(t.fetch,"GET",`${t.url}/user`,{headers:t.headers,jwt:e,xform:te}):yield t._useSession(function(){var n=(0,h.A)(function*(i){var o,a,l;const{data:u,error:c}=i;if(c)throw c;return null!==(o=u.session)&&void 0!==o&&o.access_token||t.hasCustomAuthorizationHeader?yield T(t.fetch,"GET",`${t.url}/user`,{headers:t.headers,jwt:null!==(l=null===(a=u.session)||void 0===a?void 0:a.access_token)&&void 0!==l?l:void 0,xform:te}):{data:{user:null},error:new Y}});return function(i){return n.apply(this,arguments)}}())}catch(n){if(k(n))return function Or(s){return k(s)&&"AuthSessionMissingError"===s.name}(n)&&(yield t._removeSession(),yield we(t.storage,`${t.storageKey}-code-verifier`)),{data:{user:null},error:n};throw n}})()}updateUser(e,t={}){var n=this;return(0,h.A)(function*(){return yield n.initializePromise,yield n._acquireLock(-1,(0,h.A)(function*(){return yield n._updateUser(e,t)}))})()}_updateUser(e,t={}){var n=this;return(0,h.A)(function*(){try{return yield n._useSession(function(){var i=(0,h.A)(function*(o){const{data:a,error:l}=o;if(l)throw l;if(!a.session)throw new Y;const u=a.session;let c=null,p=null;"pkce"===n.flowType&&null!=e.email&&([c,p]=yield he(n.storage,n.storageKey));const{data:_,error:m}=yield T(n.fetch,"PUT",`${n.url}/user`,{headers:n.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:c,code_challenge_method:p}),jwt:u.access_token,xform:te});if(m)throw m;return u.user=_.user,yield n._saveSession(u),yield n._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}});return function(o){return i.apply(this,arguments)}}())}catch(i){if(k(i))return{data:{user:null},error:i};throw i}})()}_decodeJWT(e){return ct(e)}setSession(e){var t=this;return(0,h.A)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,h.A)(function*(){return yield t._setSession(e)}))})()}_setSession(e){var t=this;return(0,h.A)(function*(){try{if(!e.access_token||!e.refresh_token)throw new Y;const n=Date.now()/1e3;let i=n,o=!0,a=null;const l=ct(e.access_token);if(l.exp&&(i=l.exp,o=i<=n),o){const{session:u,error:c}=yield t._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!u)return{data:{user:null,session:null},error:null};a=u}else{const{data:u,error:c}=yield t._getUser(e.access_token);if(c)throw c;a={access_token:e.access_token,refresh_token:e.refresh_token,user:u.user,token_type:"bearer",expires_in:i-n,expires_at:i},yield t._saveSession(a),yield t._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(n){if(k(n))return{data:{session:null,user:null},error:n};throw n}})()}refreshSession(e){var t=this;return(0,h.A)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,h.A)(function*(){return yield t._refreshSession(e)}))})()}_refreshSession(e){var t=this;return(0,h.A)(function*(){try{return yield t._useSession(function(){var n=(0,h.A)(function*(i){var o;if(!e){const{data:u,error:c}=i;if(c)throw c;e=null!==(o=u.session)&&void 0!==o?o:void 0}if(null==e||!e.refresh_token)throw new Y;const{session:a,error:l}=yield t._callRefreshToken(e.refresh_token);return l?{data:{user:null,session:null},error:l}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}});return function(i){return n.apply(this,arguments)}}())}catch(n){if(k(n))return{data:{user:null,session:null},error:n};throw n}})()}_getSessionFromURL(e){var t=this;return(0,h.A)(function*(){try{if(!G())throw new Se("No browser detected.");if("implicit"===t.flowType&&!t._isImplicitGrantFlow())throw new Se("Not a valid implicit grant flow url.");if("pkce"==t.flowType&&!e)throw new ht("Not a valid PKCE flow url.");const n=Ie(window.location.href);if(e){if(!n.code)throw new ht("No code detected.");const{data:Q,error:z}=yield t._exchangeCodeForSession(n.code);if(z)throw z;const wt=new URL(window.location.href);return wt.searchParams.delete("code"),window.history.replaceState(window.history.state,"",wt.toString()),{data:{session:Q.session,redirectType:null},error:null}}if(n.error||n.error_description||n.error_code)throw new Se(n.error_description||"Error in URL with unspecified error_description",{error:n.error||"unspecified_error",code:n.error_code||"unspecified_code"});const{provider_token:i,provider_refresh_token:o,access_token:a,refresh_token:l,expires_in:u,expires_at:c,token_type:p}=n;if(!(a&&u&&l&&p))throw new Se("No session defined in URL");const _=Math.round(Date.now()/1e3),m=parseInt(u);let y=_+m;c&&(y=parseInt(c));const j=y-_;1e3*j<=ve&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${j}s, should have been closer to ${m}s`);const E=y-m;_-E>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",E,y,_):_-E<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",E,y,_);const{data:H,error:V}=yield t._getUser(a);if(V)throw V;const X={provider_token:i,provider_refresh_token:o,access_token:a,expires_in:m,expires_at:y,refresh_token:l,token_type:p,user:H.user};return window.location.hash="",t._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:X,redirectType:n.type},error:null}}catch(n){if(k(n))return{data:{session:null,redirectType:null},error:n};throw n}})()}_isImplicitGrantFlow(){const e=Ie(window.location.href);return!(!G()||!e.access_token&&!e.error_description)}_isPKCEFlow(){var e=this;return(0,h.A)(function*(){const t=Ie(window.location.href),n=yield be(e.storage,`${e.storageKey}-code-verifier`);return!(!t.code||!n)})()}signOut(e={scope:"global"}){var t=this;return(0,h.A)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,h.A)(function*(){return yield t._signOut(e)}))})()}_signOut({scope:e}={scope:"global"}){var t=this;return(0,h.A)(function*(){return yield t._useSession(function(){var n=(0,h.A)(function*(i){var o;const{data:a,error:l}=i;if(l)return{error:l};const u=null===(o=a.session)||void 0===o?void 0:o.access_token;if(u){const{error:c}=yield t.admin.signOut(u,e);if(c&&(!function Tr(s){return k(s)&&"AuthApiError"===s.name}(c)||404!==c.status&&401!==c.status&&403!==c.status))return{error:c}}return"others"!==e&&(yield t._removeSession(),yield we(t.storage,`${t.storageKey}-code-verifier`)),{error:null}});return function(i){return n.apply(this,arguments)}}())})()}onAuthStateChange(e){var t=this;const n=function dr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const r=16*Math.random()|0;return("x"==s?r:3&r|8).toString(16)})}(),i={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,i),(0,h.A)(function*(){yield t.initializePromise,yield t._acquireLock(-1,(0,h.A)(function*(){t._emitInitialSession(n)}))})(),{data:{subscription:i}}}_emitInitialSession(e){var t=this;return(0,h.A)(function*(){return yield t._useSession(function(){var n=(0,h.A)(function*(i){var o,a;try{const{data:{session:l},error:u}=i;if(u)throw u;yield null===(o=t.stateChangeEmitters.get(e))||void 0===o?void 0:o.callback("INITIAL_SESSION",l),t._debug("INITIAL_SESSION","callback id",e,"session",l)}catch(l){yield null===(a=t.stateChangeEmitters.get(e))||void 0===a?void 0:a.callback("INITIAL_SESSION",null),t._debug("INITIAL_SESSION","callback id",e,"error",l),console.error(l)}});return function(i){return n.apply(this,arguments)}}())})()}resetPasswordForEmail(e,t={}){var n=this;return(0,h.A)(function*(){let i=null,o=null;"pkce"===n.flowType&&([i,o]=yield he(n.storage,n.storageKey,!0));try{return yield T(n.fetch,"POST",`${n.url}/recover`,{body:{email:e,code_challenge:i,code_challenge_method:o,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:n.headers,redirectTo:t.redirectTo})}catch(a){if(k(a))return{data:null,error:a};throw a}})()}getUserIdentities(){var e=this;return(0,h.A)(function*(){var t;try{const{data:n,error:i}=yield e.getUser();if(i)throw i;return{data:{identities:null!==(t=n.user.identities)&&void 0!==t?t:[]},error:null}}catch(n){if(k(n))return{data:null,error:n};throw n}})()}linkIdentity(e){var t=this;return(0,h.A)(function*(){var n;try{const{data:i,error:o}=yield t._useSession(function(){var a=(0,h.A)(function*(l){var u,c,p,_,m;const{data:y,error:j}=l;if(j)throw j;const E=yield t._getUrlForProvider(`${t.url}/user/identities/authorize`,e.provider,{redirectTo:null===(u=e.options)||void 0===u?void 0:u.redirectTo,scopes:null===(c=e.options)||void 0===c?void 0:c.scopes,queryParams:null===(p=e.options)||void 0===p?void 0:p.queryParams,skipBrowserRedirect:!0});return yield T(t.fetch,"GET",E,{headers:t.headers,jwt:null!==(m=null===(_=y.session)||void 0===_?void 0:_.access_token)&&void 0!==m?m:void 0})});return function(l){return a.apply(this,arguments)}}());if(o)throw o;return G()&&!(null!==(n=e.options)&&void 0!==n&&n.skipBrowserRedirect)&&window.location.assign(null==i?void 0:i.url),{data:{provider:e.provider,url:null==i?void 0:i.url},error:null}}catch(i){if(k(i))return{data:{provider:e.provider,url:null},error:i};throw i}})()}unlinkIdentity(e){var t=this;return(0,h.A)(function*(){try{return yield t._useSession(function(){var n=(0,h.A)(function*(i){var o,a;const{data:l,error:u}=i;if(u)throw u;return yield T(t.fetch,"DELETE",`${t.url}/user/identities/${e.identity_id}`,{headers:t.headers,jwt:null!==(a=null===(o=l.session)||void 0===o?void 0:o.access_token)&&void 0!==a?a:void 0})});return function(i){return n.apply(this,arguments)}}())}catch(n){if(k(n))return{data:null,error:n};throw n}})()}_refreshAccessToken(e){var t=this;return(0,h.A)(function*(){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;t._debug(n,"begin");try{const i=Date.now();return yield function _r(s,r){return new Promise((t,n)=>{(0,h.A)(function*(){for(let i=0;i<1/0;i++)try{const o=yield s(i);if(!r(i,null,o))return void t(o)}catch(o){if(!r(i,o))return void n(o)}})()})}(function(){var o=(0,h.A)(function*(a){return a>0&&(yield function gr(s){return Ue.apply(this,arguments)}(200*Math.pow(2,a-1))),t._debug(n,"refreshing attempt",a),yield T(t.fetch,"POST",`${t.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:t.headers,xform:ee})});return function(a){return o.apply(this,arguments)}}(),(o,a)=>{const l=200*Math.pow(2,o);return a&&ze(a)&&Date.now()+l-i<ve})}catch(i){if(t._debug(n,"error",i),k(i))return{data:{session:null,user:null},error:i};throw i}finally{t._debug(n,"end")}})()}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){var n=this;return(0,h.A)(function*(){const i=yield n._getUrlForProvider(`${n.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return n._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",i),G()&&!t.skipBrowserRedirect&&window.location.assign(i),{data:{provider:e,url:i},error:null}})()}_recoverAndRefresh(){var e=this;return(0,h.A)(function*(){var t;const n="#_recoverAndRefresh()";e._debug(n,"begin");try{const i=yield be(e.storage,e.storageKey);if(e._debug(n,"session from storage",i),!e._isValidSession(i))return e._debug(n,"session is not valid"),void(null!==i&&(yield e._removeSession()));const o=Math.round(Date.now()/1e3),a=(null!==(t=i.expires_at)&&void 0!==t?t:1/0)<o+10;if(e._debug(n,`session has${a?"":" not"} expired with margin of 10s`),a){if(e.autoRefreshToken&&i.refresh_token){const{error:l}=yield e._callRefreshToken(i.refresh_token);l&&(console.error(l),ze(l)||(e._debug(n,"refresh failed with a non-retryable error, removing the session",l),yield e._removeSession()))}}else yield e._notifyAllSubscribers("SIGNED_IN",i)}catch(i){return e._debug(n,"error",i),void console.error(i)}finally{e._debug(n,"end")}})()}_callRefreshToken(e){var t=this;return(0,h.A)(function*(){var n,i;if(!e)throw new Y;if(t.refreshingDeferred)return t.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;t._debug(o,"begin");try{t.refreshingDeferred=new Ae;const{data:a,error:l}=yield t._refreshAccessToken(e);if(l)throw l;if(!a.session)throw new Y;yield t._saveSession(a.session),yield t._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const u={session:a.session,error:null};return t.refreshingDeferred.resolve(u),u}catch(a){if(t._debug(o,"error",a),k(a)){const l={session:null,error:a};return ze(a)||(yield t._removeSession()),null===(n=t.refreshingDeferred)||void 0===n||n.resolve(l),l}throw null===(i=t.refreshingDeferred)||void 0===i||i.reject(a),a}finally{t.refreshingDeferred=null,t._debug(o,"end")}})()}_notifyAllSubscribers(e,t,n=!0){var i=this;return(0,h.A)(function*(){const o=`#_notifyAllSubscribers(${e})`;i._debug(o,"begin",t,`broadcast = ${n}`);try{i.broadcastChannel&&n&&i.broadcastChannel.postMessage({event:e,session:t});const a=[],l=Array.from(i.stateChangeEmitters.values()).map(function(){var u=(0,h.A)(function*(c){try{yield c.callback(e,t)}catch(p){a.push(p)}});return function(c){return u.apply(this,arguments)}}());if(yield Promise.all(l),a.length>0){for(let u=0;u<a.length;u+=1)console.error(a[u]);throw a[0]}}finally{i._debug(o,"end")}})()}_saveSession(e){var t=this;return(0,h.A)(function*(){t._debug("#_saveSession()",e),t.suppressGetSessionWarning=!0,yield lt(t.storage,t.storageKey,e)})()}_removeSession(){var e=this;return(0,h.A)(function*(){e._debug("#_removeSession()"),yield we(e.storage,e.storageKey),yield e._notifyAllSubscribers("SIGNED_OUT",null)})()}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&G()&&null!=window&&window.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){var e=this;return(0,h.A)(function*(){yield e._stopAutoRefresh(),e._debug("#_startAutoRefresh()");const t=setInterval(()=>e._autoRefreshTokenTick(),ve);e.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():typeof Deno<"u"&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout((0,h.A)(function*(){yield e.initializePromise,yield e._autoRefreshTokenTick()}),0)})()}_stopAutoRefresh(){var e=this;return(0,h.A)(function*(){e._debug("#_stopAutoRefresh()");const t=e.autoRefreshTicker;e.autoRefreshTicker=null,t&&clearInterval(t)})()}startAutoRefresh(){var e=this;return(0,h.A)(function*(){e._removeVisibilityChangedCallback(),yield e._startAutoRefresh()})()}stopAutoRefresh(){var e=this;return(0,h.A)(function*(){e._removeVisibilityChangedCallback(),yield e._stopAutoRefresh()})()}_autoRefreshTokenTick(){var e=this;return(0,h.A)(function*(){e._debug("#_autoRefreshTokenTick()","begin");try{yield e._acquireLock(0,(0,h.A)(function*(){try{const t=Date.now();try{return yield e._useSession(function(){var n=(0,h.A)(function*(i){const{data:{session:o}}=i;if(!o||!o.refresh_token||!o.expires_at)return void e._debug("#_autoRefreshTokenTick()","no session");const a=Math.floor((1e3*o.expires_at-t)/ve);e._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),a<=3&&(yield e._callRefreshToken(o.refresh_token))});return function(i){return n.apply(this,arguments)}}())}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{e._debug("#_autoRefreshTokenTick()","end")}}))}catch(t){if(!(t.isAcquireTimeout||t instanceof _t))throw t;e._debug("auto refresh token tick lock not available")}})()}_handleVisibilityChange(){var e=this;return(0,h.A)(function*(){if(e._debug("#_handleVisibilityChange()"),!G()||null==window||!window.addEventListener)return e.autoRefreshToken&&e.startAutoRefresh(),!1;try{e.visibilityChangedCallback=(0,h.A)(function*(){return yield e._onVisibilityChanged(!1)}),null==window||window.addEventListener("visibilitychange",e.visibilityChangedCallback),yield e._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}})()}_onVisibilityChanged(e){var t=this;return(0,h.A)(function*(){const n=`#_onVisibilityChanged(${e})`;t._debug(n,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(t.autoRefreshToken&&t._startAutoRefresh(),e||(yield t.initializePromise,yield t._acquireLock(-1,(0,h.A)(function*(){"visible"===document.visibilityState?yield t._recoverAndRefresh():t._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&t.autoRefreshToken&&t._stopAutoRefresh()})()}_getUrlForProvider(e,t,n){var i=this;return(0,h.A)(function*(){const o=[`provider=${encodeURIComponent(t)}`];if(null!=n&&n.redirectTo&&o.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),null!=n&&n.scopes&&o.push(`scopes=${encodeURIComponent(n.scopes)}`),"pkce"===i.flowType){const[a,l]=yield he(i.storage,i.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(l)}`});o.push(u.toString())}if(null!=n&&n.queryParams){const a=new URLSearchParams(n.queryParams);o.push(a.toString())}return null!=n&&n.skipBrowserRedirect&&o.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${o.join("&")}`})()}_unenroll(e){var t=this;return(0,h.A)(function*(){try{return yield t._useSession(function(){var n=(0,h.A)(function*(i){var o;const{data:a,error:l}=i;return l?{data:null,error:l}:yield T(t.fetch,"DELETE",`${t.url}/factors/${e.factorId}`,{headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token})});return function(i){return n.apply(this,arguments)}}())}catch(n){if(k(n))return{data:null,error:n};throw n}})()}_enroll(e){var t=this;return(0,h.A)(function*(){try{return yield t._useSession(function(){var n=(0,h.A)(function*(i){var o,a;const{data:l,error:u}=i;if(u)return{data:null,error:u};const c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:p,error:_}=yield T(t.fetch,"POST",`${t.url}/factors`,{body:c,headers:t.headers,jwt:null===(o=null==l?void 0:l.session)||void 0===o?void 0:o.access_token});return _?{data:null,error:_}:("totp"===e.factorType&&!(null===(a=null==p?void 0:p.totp)||void 0===a)&&a.qr_code&&(p.totp.qr_code=`data:image/svg+xml;utf-8,${p.totp.qr_code}`),{data:p,error:null})});return function(i){return n.apply(this,arguments)}}())}catch(n){if(k(n))return{data:null,error:n};throw n}})()}_verify(e){var t=this;return(0,h.A)(function*(){return t._acquireLock(-1,(0,h.A)(function*(){try{return yield t._useSession(function(){var n=(0,h.A)(function*(i){var o;const{data:a,error:l}=i;if(l)return{data:null,error:l};const{data:u,error:c}=yield T(t.fetch,"POST",`${t.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token});return c?{data:null,error:c}:(yield t._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),yield t._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:c})});return function(i){return n.apply(this,arguments)}}())}catch(n){if(k(n))return{data:null,error:n};throw n}}))})()}_challenge(e){var t=this;return(0,h.A)(function*(){return t._acquireLock(-1,(0,h.A)(function*(){try{return yield t._useSession(function(){var n=(0,h.A)(function*(i){var o;const{data:a,error:l}=i;return l?{data:null,error:l}:yield T(t.fetch,"POST",`${t.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token})});return function(i){return n.apply(this,arguments)}}())}catch(n){if(k(n))return{data:null,error:n};throw n}}))})()}_challengeAndVerify(e){var t=this;return(0,h.A)(function*(){const{data:n,error:i}=yield t._challenge({factorId:e.factorId});return i?{data:null,error:i}:yield t._verify({factorId:e.factorId,challengeId:n.id,code:e.code})})()}_listFactors(){var e=this;return(0,h.A)(function*(){const{data:{user:t},error:n}=yield e.getUser();if(n)return{data:null,error:n};const i=(null==t?void 0:t.factors)||[],o=i.filter(l=>"totp"===l.factor_type&&"verified"===l.status),a=i.filter(l=>"phone"===l.factor_type&&"verified"===l.status);return{data:{all:i,totp:o,phone:a},error:null}})()}_getAuthenticatorAssuranceLevel(){var e=this;return(0,h.A)(function*(){return e._acquireLock(-1,(0,h.A)(function*(){return yield e._useSession(function(){var t=(0,h.A)(function*(n){var i,o;const{data:{session:a},error:l}=n;if(l)return{data:null,error:l};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const u=e._decodeJWT(a.access_token);let c=null;u.aal&&(c=u.aal);let p=c;return(null!==(o=null===(i=a.user.factors)||void 0===i?void 0:i.filter(y=>"verified"===y.status))&&void 0!==o?o:[]).length>0&&(p="aal2"),{data:{currentLevel:c,nextLevel:p,currentAuthenticationMethods:u.amr||[]},error:null}});return function(n){return t.apply(this,arguments)}}())}))})()}}return s.nextInstanceID=0,s})();class qr extends Hr{constructor(r){super(r)}}class Wr{constructor(r,e,t){var n,i,o;if(this.supabaseUrl=r,this.supabaseKey=e,!r)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");const a=function or(s){return s.replace(/\/$/,"")}(r);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,c=function ar(s,r){const{db:e,auth:t,realtime:n,global:i}=s,{db:o,auth:a,realtime:l,global:u}=r,c={db:Object.assign(Object.assign({},o),e),auth:Object.assign(Object.assign({},a),t),realtime:Object.assign(Object.assign({},l),n),global:Object.assign(Object.assign({},u),i),accessToken:()=>function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(c){try{u(t.next(c))}catch(p){o(p)}}function l(c){try{u(t.throw(c))}catch(p){o(p)}}function u(c){c.done?i(c.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(c.value).then(a,l)}u((t=t.apply(s,r||[])).next())})}(this,void 0,void 0,function*(){return""})};return s.accessToken?c.accessToken=s.accessToken:delete c.accessToken,c}(null!=t?t:{},{db:Zt,realtime:er,auth:Object.assign(Object.assign({},Yt),{storageKey:l}),global:Xt});this.storageKey=null!==(n=c.auth.storageKey)&&void 0!==n?n:"",this.headers=null!==(i=c.global.headers)&&void 0!==i?i:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(p,_)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(_)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(o=c.auth)&&void 0!==o?o:{},this.headers,c.global.fetch),this.fetch=sr(e,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},c.realtime)),this.rest=new C(`${a}/rest/v1`,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),c.accessToken||this._listenForAuthEvents()}get functions(){return new x(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Vt(this.storageUrl,this.headers,this.fetch)}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,e={},t={}){return this.rest.rpc(r,e,t)}channel(r,e={config:{}}){return this.realtime.channel(r,e)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var r,e;return function(s,r,e,t){return new(e||(e=Promise))(function(i,o){function a(c){try{u(t.next(c))}catch(p){o(p)}}function l(c){try{u(t.throw(c))}catch(p){o(p)}}function u(c){c.done?i(c.value):function n(i){return i instanceof e?i:new e(function(o){o(i)})}(c.value).then(a,l)}u((t=t.apply(s,r||[])).next())})}(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:t}=yield this.auth.getSession();return null!==(e=null===(r=t.session)||void 0===r?void 0:r.access_token)&&void 0!==e?e:null})}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,storageKey:i,flowType:o,lock:a,debug:l},u,c){var p;return new qr({url:this.authUrl,headers:Object.assign(Object.assign({},{Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`}),u),storageKey:i,autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,flowType:o,lock:a,debug:l,fetch:c,hasCustomAuthorizationHeader:null!==(p="Authorization"in this.headers)&&void 0!==p&&p})}_initRealtimeClient(r){return new Lt(this.realtimeUrl,Object.assign(Object.assign({},r),{params:Object.assign({apikey:this.supabaseKey},null==r?void 0:r.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(r,e,t){"TOKEN_REFRESHED"!==r&&"SIGNED_IN"!==r||this.changedAccessToken===t?"SIGNED_OUT"===r&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!=t?t:null),this.changedAccessToken=t)}}var bt=b(4438),Qr=b(9942);let Xr=(()=>{var s;class r{constructor(t){this.apiService=t,this.supabaseUrl="https://xgdujjqhurmzfxelhysh.supabase.co",this.supabaseKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhnZHVqanFodXJtemZ4ZWxoeXNoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcyOTA0Mjc4MiwiZXhwIjoyMDQ0NjE4NzgyfQ.KYtZw9QcelyNh8TmOGNkBknpo0eH5UoZy2zXfbP7ZuU",this.supabase=(()=>new Wr(this.supabaseUrl,this.supabaseKey,void 0))(),this.path="producto"}subirImagen(t,n){var i=this;return(0,h.A)(function*(){if(!t.includes(","))throw new Error("Formato de imagen base64 no v\xe1lido");const o=t.split(",")[1],a=t.split(",")[0].split(":")[1].split(";")[0],l=atob(o),u=new Array(l.length);for(let y=0;y<l.length;y++)u[y]=l.charCodeAt(y);const c=new Uint8Array(u),p=new Blob([c],{type:a}),{data:_,error:m}=yield i.supabase.storage.from("productos").upload(n,p,{contentType:a,upsert:!0});if(m)throw m;return _.path})()}agregarProducto(t){var n=this;return(0,h.A)(function*(){if(t.imagen){const o=`productos/${t.codproducto}.jpg`;t.imagen=yield n.subirImagen(t.imagen,o)}if(!(yield n.apiService.post(n.path,t).toPromise()))throw new Error("Error al agregar el producto")})()}obtener_productos(t,n){const i=(new S.Nl).set("select","*").set("offset",(t*n).toString()).set("limit",n.toString());return this.apiService.get(this.path,i).pipe((0,U.T)(o=>{const a=o.body||[];return a.forEach(l=>{if(l.imagen){const{data:u}=this.supabase.storage.from("productos").getPublicUrl(l.imagen);l.imagenUrl=u.publicUrl}}),new S.cS({body:a,headers:o.headers,status:o.status,statusText:o.statusText})}))}actualizarDescripcionProducto(t,n){return this.apiService.patch(`${this.path}/${t}`,{descripcion:n})}modificarProductoDescripcion(t,n){return this.apiService.patch(`producto?idproducto=eq.${t}`,{descripcion:n})}eliminarProducto(t){const n=(new S.Nl).set("idproducto",`eq.${t}`);return this.apiService.delete("producto",n)}}return(s=r).\u0275fac=function(t){return new(t||s)(bt.KVO(Qr.s))},s.\u0275prov=bt.jDH({token:s,factory:s.\u0275fac,providedIn:"root"}),r})()},5286:(B,w,b)=>{"use strict";b.r(w),b.d(w,{Headers:()=>d,Request:()=>f,Response:()=>g,default:()=>O,fetch:()=>U});var S=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}();const U=S.fetch,O=S.fetch.bind(S),d=S.Headers,f=S.Request,g=S.Response},5958:function(B,w,b){"use strict";var h=b(9293).default,S=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(w,"__esModule",{value:!0});const U=S(b(5286)),O=S(b(4659));w.default=class d{constructor(g){this.shouldThrowOnError=!1,this.method=g.method,this.url=g.url,this.headers=g.headers,this.schema=g.schema,this.body=g.body,this.shouldThrowOnError=g.shouldThrowOnError,this.signal=g.signal,this.isMaybeSingle=g.isMaybeSingle,this.fetch=g.fetch?g.fetch:typeof fetch>"u"?U.default:fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(g,v){return this.headers=Object.assign({},this.headers),this.headers[g]=v,this}then(g,v){var A=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let x=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(function(){var P=h(function*(C){var N,J,q;let I=null,F=null,ye=null,re=C.status,ne=C.statusText;if(C.ok){if("HEAD"!==A.method){const D=yield C.text();""===D||(F="text/csv"===A.headers.Accept||A.headers.Accept&&A.headers.Accept.includes("application/vnd.pgrst.plan+text")?D:JSON.parse(D))}const se=null===(N=A.headers.Prefer)||void 0===N?void 0:N.match(/count=(exact|planned|estimated)/),K=null===(J=C.headers.get("content-range"))||void 0===J?void 0:J.split("/");se&&K&&K.length>1&&(ye=parseInt(K[1])),A.isMaybeSingle&&"GET"===A.method&&Array.isArray(F)&&(F.length>1?(I={code:"PGRST116",details:`Results contain ${F.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},F=null,ye=null,re=406,ne="Not Acceptable"):F=1===F.length?F[0]:null)}else{const se=yield C.text();try{I=JSON.parse(se),Array.isArray(I)&&404===C.status&&(F=[],I=null,re=200,ne="OK")}catch{404===C.status&&""===se?(re=204,ne="No Content"):I={message:se}}if(I&&A.isMaybeSingle&&!(null===(q=null==I?void 0:I.details)||void 0===q)&&q.includes("0 rows")&&(I=null,re=200,ne="OK"),I&&A.shouldThrowOnError)throw new O.default(I)}return{error:I,data:F,count:ye,status:re,statusText:ne}});return function(C){return P.apply(this,arguments)}}());return this.shouldThrowOnError||(x=x.catch(P=>{var C,N,J;return{error:{message:`${null!==(C=null==P?void 0:P.name)&&void 0!==C?C:"FetchError"}: ${null==P?void 0:P.message}`,details:`${null!==(N=null==P?void 0:P.stack)&&void 0!==N?N:""}`,hint:"",code:`${null!==(J=null==P?void 0:P.code)&&void 0!==J?J:""}`},data:null,count:null,status:0,statusText:""}})),x.then(g,v)}}},3242:function(B,w,b){"use strict";var h=this&&this.__importDefault||function(f){return f&&f.__esModule?f:{default:f}};Object.defineProperty(w,"__esModule",{value:!0});const S=h(b(8666)),U=h(b(3608)),O=b(3057);class d{constructor(g,{headers:v={},schema:A,fetch:$}={}){this.url=g,this.headers=Object.assign(Object.assign({},O.DEFAULT_HEADERS),v),this.schemaName=A,this.fetch=$}from(g){const v=new URL(`${this.url}/${g}`);return new S.default(v,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(g){return new d(this.url,{headers:this.headers,schema:g,fetch:this.fetch})}rpc(g,v={},{head:A=!1,get:$=!1,count:x}={}){let P;const C=new URL(`${this.url}/rpc/${g}`);let N;A||$?(P=A?"HEAD":"GET",Object.entries(v).filter(([q,I])=>void 0!==I).map(([q,I])=>[q,Array.isArray(I)?`{${I.join(",")}}`:`${I}`]).forEach(([q,I])=>{C.searchParams.append(q,I)})):(P="POST",N=v);const J=Object.assign({},this.headers);return x&&(J.Prefer=`count=${x}`),new U.default({method:P,url:C,headers:J,schema:this.schemaName,body:N,fetch:this.fetch,allowEmpty:!1})}}w.default=d},4659:(B,w)=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});class b extends Error{constructor(S){super(S.message),this.name="PostgrestError",this.details=S.details,this.hint=S.hint,this.code=S.code}}w.default=b},3608:function(B,w,b){"use strict";var h=this&&this.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(w,"__esModule",{value:!0});const S=h(b(3342));w.default=class U extends S.default{eq(d,f){return this.url.searchParams.append(d,`eq.${f}`),this}neq(d,f){return this.url.searchParams.append(d,`neq.${f}`),this}gt(d,f){return this.url.searchParams.append(d,`gt.${f}`),this}gte(d,f){return this.url.searchParams.append(d,`gte.${f}`),this}lt(d,f){return this.url.searchParams.append(d,`lt.${f}`),this}lte(d,f){return this.url.searchParams.append(d,`lte.${f}`),this}like(d,f){return this.url.searchParams.append(d,`like.${f}`),this}likeAllOf(d,f){return this.url.searchParams.append(d,`like(all).{${f.join(",")}}`),this}likeAnyOf(d,f){return this.url.searchParams.append(d,`like(any).{${f.join(",")}}`),this}ilike(d,f){return this.url.searchParams.append(d,`ilike.${f}`),this}ilikeAllOf(d,f){return this.url.searchParams.append(d,`ilike(all).{${f.join(",")}}`),this}ilikeAnyOf(d,f){return this.url.searchParams.append(d,`ilike(any).{${f.join(",")}}`),this}is(d,f){return this.url.searchParams.append(d,`is.${f}`),this}in(d,f){const g=Array.from(new Set(f)).map(v=>"string"==typeof v&&new RegExp("[,()]").test(v)?`"${v}"`:`${v}`).join(",");return this.url.searchParams.append(d,`in.(${g})`),this}contains(d,f){return"string"==typeof f?this.url.searchParams.append(d,`cs.${f}`):Array.isArray(f)?this.url.searchParams.append(d,`cs.{${f.join(",")}}`):this.url.searchParams.append(d,`cs.${JSON.stringify(f)}`),this}containedBy(d,f){return"string"==typeof f?this.url.searchParams.append(d,`cd.${f}`):Array.isArray(f)?this.url.searchParams.append(d,`cd.{${f.join(",")}}`):this.url.searchParams.append(d,`cd.${JSON.stringify(f)}`),this}rangeGt(d,f){return this.url.searchParams.append(d,`sr.${f}`),this}rangeGte(d,f){return this.url.searchParams.append(d,`nxl.${f}`),this}rangeLt(d,f){return this.url.searchParams.append(d,`sl.${f}`),this}rangeLte(d,f){return this.url.searchParams.append(d,`nxr.${f}`),this}rangeAdjacent(d,f){return this.url.searchParams.append(d,`adj.${f}`),this}overlaps(d,f){return this.url.searchParams.append(d,"string"==typeof f?`ov.${f}`:`ov.{${f.join(",")}}`),this}textSearch(d,f,{config:g,type:v}={}){let A="";return"plain"===v?A="pl":"phrase"===v?A="ph":"websearch"===v&&(A="w"),this.url.searchParams.append(d,`${A}fts${void 0===g?"":`(${g})`}.${f}`),this}match(d){return Object.entries(d).forEach(([f,g])=>{this.url.searchParams.append(f,`eq.${g}`)}),this}not(d,f,g){return this.url.searchParams.append(d,`not.${f}.${g}`),this}or(d,{foreignTable:f,referencedTable:g=f}={}){return this.url.searchParams.append(g?`${g}.or`:"or",`(${d})`),this}filter(d,f,g){return this.url.searchParams.append(d,`${f}.${g}`),this}}},8666:function(B,w,b){"use strict";var h=this&&this.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(w,"__esModule",{value:!0});const S=h(b(3608));w.default=class U{constructor(d,{headers:f={},schema:g,fetch:v}){this.url=d,this.headers=f,this.schema=g,this.fetch=v}select(d,{head:f=!1,count:g}={}){const v=f?"HEAD":"GET";let A=!1;const $=(null!=d?d:"*").split("").map(x=>/\s/.test(x)&&!A?"":('"'===x&&(A=!A),x)).join("");return this.url.searchParams.set("select",$),g&&(this.headers.Prefer=`count=${g}`),new S.default({method:v,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(d,{count:f,defaultToNull:g=!0}={}){const A=[];if(this.headers.Prefer&&A.push(this.headers.Prefer),f&&A.push(`count=${f}`),g||A.push("missing=default"),this.headers.Prefer=A.join(","),Array.isArray(d)){const $=d.reduce((x,P)=>x.concat(Object.keys(P)),[]);if($.length>0){const x=[...new Set($)].map(P=>`"${P}"`);this.url.searchParams.set("columns",x.join(","))}}return new S.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:d,fetch:this.fetch,allowEmpty:!1})}upsert(d,{onConflict:f,ignoreDuplicates:g=!1,count:v,defaultToNull:A=!0}={}){const x=[`resolution=${g?"ignore":"merge"}-duplicates`];if(void 0!==f&&this.url.searchParams.set("on_conflict",f),this.headers.Prefer&&x.push(this.headers.Prefer),v&&x.push(`count=${v}`),A||x.push("missing=default"),this.headers.Prefer=x.join(","),Array.isArray(d)){const P=d.reduce((C,N)=>C.concat(Object.keys(N)),[]);if(P.length>0){const C=[...new Set(P)].map(N=>`"${N}"`);this.url.searchParams.set("columns",C.join(","))}}return new S.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:d,fetch:this.fetch,allowEmpty:!1})}update(d,{count:f}={}){const v=[];return this.headers.Prefer&&v.push(this.headers.Prefer),f&&v.push(`count=${f}`),this.headers.Prefer=v.join(","),new S.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:d,fetch:this.fetch,allowEmpty:!1})}delete({count:d}={}){const g=[];return d&&g.push(`count=${d}`),this.headers.Prefer&&g.unshift(this.headers.Prefer),this.headers.Prefer=g.join(","),new S.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}},3342:function(B,w,b){"use strict";var h=this&&this.__importDefault||function(O){return O&&O.__esModule?O:{default:O}};Object.defineProperty(w,"__esModule",{value:!0});const S=h(b(5958));w.default=class U extends S.default{select(d){let f=!1;const g=(null!=d?d:"*").split("").map(v=>/\s/.test(v)&&!f?"":('"'===v&&(f=!f),v)).join("");return this.url.searchParams.set("select",g),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(d,{ascending:f=!0,nullsFirst:g,foreignTable:v,referencedTable:A=v}={}){const $=A?`${A}.order`:"order",x=this.url.searchParams.get($);return this.url.searchParams.set($,`${x?`${x},`:""}${d}.${f?"asc":"desc"}${void 0===g?"":g?".nullsfirst":".nullslast"}`),this}limit(d,{foreignTable:f,referencedTable:g=f}={}){return this.url.searchParams.set(typeof g>"u"?"limit":`${g}.limit`,`${d}`),this}range(d,f,{foreignTable:g,referencedTable:v=g}={}){const $=typeof v>"u"?"limit":`${v}.limit`;return this.url.searchParams.set(typeof v>"u"?"offset":`${v}.offset`,`${d}`),this.url.searchParams.set($,""+(f-d+1)),this}abortSignal(d){return this.signal=d,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.headers.Accept="GET"===this.method?"application/json":"application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:d=!1,verbose:f=!1,settings:g=!1,buffers:v=!1,wal:A=!1,format:$="text"}={}){var x;const P=[d?"analyze":null,f?"verbose":null,g?"settings":null,v?"buffers":null,A?"wal":null].filter(Boolean).join("|"),C=null!==(x=this.headers.Accept)&&void 0!==x?x:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${$}; for="${C}"; options=${P};`,this}rollback(){var d;return(null!==(d=this.headers.Prefer)&&void 0!==d?d:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}},3057:(B,w,b)=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0}),w.DEFAULT_HEADERS=void 0;const h=b(3056);w.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${h.version}`}},4060:function(B,w,b){"use strict";var h=this&&this.__importDefault||function(v){return v&&v.__esModule?v:{default:v}};Object.defineProperty(w,"__esModule",{value:!0}),w.PostgrestError=w.PostgrestBuilder=w.PostgrestTransformBuilder=w.PostgrestFilterBuilder=w.PostgrestQueryBuilder=w.PostgrestClient=void 0;const S=h(b(3242));w.PostgrestClient=S.default;const U=h(b(8666));w.PostgrestQueryBuilder=U.default;const O=h(b(3608));w.PostgrestFilterBuilder=O.default;const d=h(b(3342));w.PostgrestTransformBuilder=d.default;const f=h(b(5958));w.PostgrestBuilder=f.default;const g=h(b(4659));w.PostgrestError=g.default,w.default={PostgrestClient:S.default,PostgrestQueryBuilder:U.default,PostgrestFilterBuilder:O.default,PostgrestTransformBuilder:d.default,PostgrestBuilder:f.default,PostgrestError:g.default}},3056:(B,w)=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0}),w.version=void 0,w.version="0.0.0-automated"},9293:B=>{function w(h,S,U,O,d,f,g){try{var v=h[f](g),A=v.value}catch($){return void U($)}v.done?S(A):Promise.resolve(A).then(O,d)}B.exports=function b(h){return function(){var S=this,U=arguments;return new Promise(function(O,d){var f=h.apply(S,U);function g(A){w(f,O,d,g,v,"next",A)}function v(A){w(f,O,d,g,v,"throw",A)}g(void 0)})}},B.exports.__esModule=!0,B.exports.default=B.exports}}]);